<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Shupogaki ğŸ’¢</title>
        <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #6F8FAF;
            overflow: hidden;
        }
        .canvas-container {
            width: 150vmin;
            height: 150vmin;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        canvas {
            max-width: 100%;
            max-height: 100%;
            display: block;
        }
        #start-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-family: sans-serif, "Malgun Gothic", "Meiryo", "sans-serif";
            cursor: pointer;
            z-index: 10;
            text-align: center;
            padding: 2em;
            box-sizing: border-box; /* íŒ¨ë”©ì´ í¬ê¸°ë¥¼ ë„˜ì§€ ì•Šë„ë¡ ì„¤ì • */
        }
        .overlay-content {
            display: flex;
            flex-direction: column;
            gap: 1em; /* í•­ëª© ê°„ ê°„ê²© */
            max-width: 800px;
        }
        .overlay-content h1 {
            font-size: 2.5em;
            margin: 0;
        }
        .overlay-content p {
            font-size: 1.2em;
            line-height: 1.6;
            margin: 0;
        }
        .start-prompt {
            font-size: 1.5em !important;
            font-weight: bold;
            color: #ffdd57; /* ëˆˆì— ë„ëŠ” ìƒ‰ìƒ */
            margin-top: 1em !important;
        }
        .disclaimer {
            font-size: 0.8em !important;
            color: rgba(255, 255, 255, 0.7); /* íë¦° ìƒ‰ìƒ */
            margin-top: 2em !important;
        }
        </style>
    </head>
    <body>
        <div class="canvas-container"></div>
        
        <div id="start-overlay">
            <div class="overlay-content">
                <h1 id="text-title"></h1>
                <p id="text-body"></p>
                <p id="text-sub-body"></p>
                <p id="text-start" class="start-prompt"></p>
                <p id="text-disclaimer" class="disclaimer"></p>
            </div>
        </div>

        <script type="module">
            import init from './shupogaki.js';

            const startOverlay = document.getElementById('start-overlay');
            const container = document.querySelector('.canvas-container');

            // --- ë‹¤êµ­ì–´ í…ìŠ¤íŠ¸ ì„¤ì • ë¡œì§ ---
            const translations = {
                ko: {
                    title: "ì•ˆë‚´",
                    body: "ì´ ê²Œì„ì€ \'Blue Archive\'ì˜ 2ì°¨ ì°½ì‘ë¬¼ì…ë‹ˆë‹¤.",
                    subBody: "ì›ì €ì‘ê¶Œìì¸ Nexon Gamesì˜ ê¶Œë¦¬ë¥¼ ìµœìš°ì„ ìœ¼ë¡œ ì¡´ì¤‘í•˜ë©°, ìš”ì²­ ì‹œ ë¹„ê³µê°œ ë˜ëŠ” ì‚­ì œì²˜ë¦¬í•  ì˜ˆì •ì…ë‹ˆë‹¤.",
                    start: "- í´ë¦­í•˜ì—¬ ê²Œì„ì„ ì‹œì‘í•˜ê¸° -",
                    disclaimer: "ë©´ì±… ì¡°í•­: í”Œë ˆì´ì— ì§€ì¥ì„ ì£¼ëŠ” ë¬¸ì œê°€ ìƒê¸¸ ìˆ˜ ìˆìœ¼ë©°, ê³µì§€ ì—†ì´ ì„œë¹„ìŠ¤ê°€ ì¤‘ë‹¨ë˜ê±°ë‚˜ ì‚¬ìš©ì ë°ì´í„°ê°€ ì‚­ì œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
                },
                ja: {
                    title: "ã”æ¡ˆå†…",
                    body: "ã“ã®ã‚²ãƒ¼ãƒ ã¯ã€ãƒ–ãƒ«ãƒ¼ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã€ã®äºŒæ¬¡å‰µä½œä½œå“ã§ã™ã€‚",
                    subBody: "åŸè‘—ä½œæ¨©è€…ã§ã‚ã‚‹Nexon Gamesã®æ¨©åˆ©ã‚’æœ€å„ªå…ˆã«å°Šé‡ã—ã€ã”è¦è«‹ãŒã‚ã£ãŸå ´åˆã«ã¯éå…¬é–‹ã¾ãŸã¯å‰Šé™¤ã„ãŸã—ã¾ã™ã€‚",
                    start: "- ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ -",
                    disclaimer: "å…è²¬äº‹é …ï¼šãƒ—ãƒ¬ã‚¤ã«æ”¯éšœã‚’ããŸã™å•é¡ŒãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã€äºˆå‘Šãªãã‚µãƒ¼ãƒ“ã‚¹ãŒä¸­æ–­ã•ã‚ŒãŸã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚ŒãŸã‚Šã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚"
                },
                en: {
                    title: "Notice",
                    body: "This game is an unofficial fan-made work based on \'Blue Archive\'.",
                    subBody: "The rights of the original copyright holder, Nexon Games, are respected with the highest priority, and this content will be made private or deleted upon request.",
                    start: "- Click to Start the Game -",
                    disclaimer: "Disclaimer: Issues that impede gameplay may occur, and the service may be suspended or user data deleted without notice."
                }
            };

            // ë¸Œë¼ìš°ì € ì–¸ì–´ ê°ì§€ ë° í…ìŠ¤íŠ¸ ì ìš©
            const userLang = navigator.language.split('-')[0]; // 'ko-KR' -> 'ko'
            const lang = translations[userLang] ? userLang : 'en'; // ì§€ì› ì–¸ì–´ ì—†ìœ¼ë©´ ì˜ì–´ë¡œ
            
            document.getElementById('text-title').textContent = translations[lang].title;
            document.getElementById('text-body').textContent = translations[lang].body;
            document.getElementById('text-sub-body').textContent = translations[lang].subBody;
            document.getElementById('text-start').textContent = translations[lang].start;
            document.getElementById('text-disclaimer').textContent = translations[lang].disclaimer;
            
            // Bevy ì•± ì‹¤í–‰ í•¨ìˆ˜ 
            async function runBevyApp() {
                await init();
                const canvas = document.querySelector('canvas');
                if (canvas) {
                    container.appendChild(canvas);

                    function resizeCanvas() {
                        const containerRect = container.getBoundingClientRect();
                        const aspectRatio = 16 / 9;
                        let newWidth, newHeight;
                        if (containerRect.width / containerRect.height > aspectRatio) {
                            newHeight = containerRect.height;
                            newWidth = newHeight * aspectRatio;
                        } else {
                            newWidth = containerRect.width;
                            newHeight = newWidth / aspectRatio;
                        }
                        canvas.style.width = newWidth + 'px';
                        canvas.style.height = newHeight + 'px';
                    }
                    window.addEventListener('resize', resizeCanvas);
                    resizeCanvas();
                }
            }

            // ì˜¤ë””ì˜¤ í™œì„±í™” ë° ê²Œì„ ì‹œì‘ í•¨ìˆ˜ 
            const unlockAudioAndStartGame = async () => {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                }
                const source = audioContext.createBufferSource();
                source.buffer = audioContext.createBuffer(1, 1, 22050);
                source.connect(audioContext.destination);
                source.start(0);
                startOverlay.style.display = 'none';
                await runBevyApp();
            };

            // í´ë¦­ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ 
            startOverlay.addEventListener('click', unlockAudioAndStartGame, { once: true });
        </script>
    </body>
</html>
