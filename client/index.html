<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Shupogaki üí¢</title>
        <link rel="icon", href="assets/Highlander.svg", type="image/svg+xml">
        <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column; 
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #6F8FAF;
            overflow: hidden;
        }
        .canvas-container {
            width: 100vmin;
            height: 100vmin;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        canvas {
            max-width: 100%;
            max-height: 100%;
            display: block;
        }
        #start-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-family: sans-serif, "Malgun Gothic", "Meiryo", "sans-serif";
            cursor: pointer;
            z-index: 10;
            text-align: center;
            padding: 2em;
            box-sizing: border-box; /* Ìå®Îî©Ïù¥ ÌÅ¨Í∏∞Î•º ÎÑòÏßÄ ÏïäÎèÑÎ°ù ÏÑ§Ï†ï */
        }
        .overlay-content {
            display: flex;
            flex-direction: column;
            gap: 1em; /* Ìï≠Î™© Í∞Ñ Í∞ÑÍ≤© */
        }
        .overlay-content h1 {
            font-size: 2.5em;
            margin: 0;
        }
        .overlay-content p {
            font-size: 1.2em;
            line-height: 1.6;
            margin: 0;
        }
        .start-prompt {
            font-size: 1.5em !important;
            font-weight: bold;
            color: #ffdd57; /* ÎààÏóê ÎùÑÎäî ÏÉâÏÉÅ */
            margin-top: 1em !important;
        }
        .disclaimer {
            font-size: 0.8em !important;
            color: rgba(255, 255, 255, 0.7); /* ÌùêÎ¶∞ ÏÉâÏÉÅ */
            margin-top: 2em !important;
        }
        .github-link {
            margin-top: 15px; 
            display: inline-block;
        }
        .github-link svg {
            width: 40px;
            height: 40px;
            fill: #ffffff;
            transition: opacity 0.2s ease-in-out;
        }
        .github-link:hover svg {
            opacity: 0.7;
        }
        #tutorial-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            display: none;
        }
        #tutorial-overlay img {
            max-width: 90%;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 8px;
        }
        </style>
    </head>
    <body>
        <div class="canvas-container"></div>
        
        <a href="https://github.com/HK416/shupogaki" target="_blank" rel="noopener noreferrer" class="github-link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16">
                <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/>
            </svg>
        </a>

        <div id="start-overlay">
            <div class="overlay-content">
                <h1 id="text-title"></h1>
                <p id="text-body"></p>
                <p id="text-sub-body"></p>
                <p id="text-start" class="start-prompt"></p>
                <p id="text-disclaimer" class="disclaimer"></p>
            </div>
        </div>

        <div id = "tutorial-overlay">
            <img id="tutorial-image", src="">
        </div>

        <script type="module">
            import init from './shupogaki.js';

            const startOverlay = document.getElementById('start-overlay');
            const container = document.querySelector('.canvas-container');

            // --- Îã§Íµ≠Ïñ¥ ÌÖçÏä§Ìä∏ ÏÑ§Ï†ï Î°úÏßÅ ---
            const translations = {
                ko: {
                    web_title: "Ï≤†ÎèÑÍ∞ÄÌÇ§ üí¢",
                    title: "ÏïàÎÇ¥",
                    body: "Ïù¥ Í≤åÏûÑÏùÄ \'Blue Archive\'Ïùò 2Ï∞® Ï∞ΩÏûëÎ¨ºÏûÖÎãàÎã§.",
                    subBody: "ÏõêÏ†ÄÏûëÍ∂åÏûêÏù∏ Nexon GamesÏùò Í∂åÎ¶¨Î•º ÏµúÏö∞ÏÑ†ÏúºÎ°ú Ï°¥Ï§ëÌïòÎ©∞, ÏöîÏ≤≠ Ïãú ÎπÑÍ≥µÍ∞ú ÎòêÎäî ÏÇ≠Ï†úÏ≤òÎ¶¨Ìï† ÏòàÏ†ïÏûÖÎãàÎã§.",
                    start: "- ÌÅ¥Î¶≠ÌïòÏó¨ Í≤åÏûÑÏùÑ ÏãúÏûëÌïòÍ∏∞ -",
                    disclaimer: "Î©¥Ï±Ö Ï°∞Ìï≠: ÌîåÎ†àÏù¥Ïóê ÏßÄÏû•ÏùÑ Ï£ºÎäî Î¨∏Ï†úÍ∞Ä ÏÉùÍ∏∏ Ïàò ÏûàÏúºÎ©∞, Í≥µÏßÄ ÏóÜÏù¥ ÏÑúÎπÑÏä§Í∞Ä Ï§ëÎã®ÎêòÍ±∞ÎÇò ÏÇ¨Ïö©Ïûê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎê† Ïàò ÏûàÏäµÎãàÎã§."
                },
                ja: {
                    web_title: "„Ç∑„É•„Éù„Ç¨„Ç≠ üí¢",
                    title: "„ÅîÊ°àÂÜÖ",
                    body: "„Åì„ÅÆ„Ç≤„Éº„É†„ÅØ„Äé„Éñ„É´„Éº„Ç¢„Éº„Ç´„Ç§„Éñ„Äè„ÅÆ‰∫åÊ¨°Ââµ‰Ωú‰ΩúÂìÅ„Åß„Åô„ÄÇ",
                    subBody: "ÂéüËëó‰ΩúÊ®©ËÄÖ„Åß„ÅÇ„ÇãNexon Games„ÅÆÊ®©Âà©„ÇíÊúÄÂÑ™ÂÖà„Å´Â∞äÈáç„Åó„ÄÅ„ÅîË¶ÅË´ã„Åå„ÅÇ„Å£„ÅüÂ†¥Âêà„Å´„ÅØÈùûÂÖ¨Èñã„Åæ„Åü„ÅØÂâäÈô§„ÅÑ„Åü„Åó„Åæ„Åô„ÄÇ",
                    start: "- „ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Ç≤„Éº„É†„ÇíÈñãÂßã -",
                    disclaimer: "ÂÖçË≤¨‰∫ãÈ†ÖÔºö„Éó„É¨„Ç§„Å´ÊîØÈöú„Çí„Åç„Åü„ÅôÂïèÈ°å„ÅåÁô∫Áîü„Åô„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„ÄÅ‰∫àÂëä„Å™„Åè„Çµ„Éº„Éì„Çπ„Åå‰∏≠Êñ≠„Åï„Çå„Åü„Çä„ÄÅ„É¶„Éº„Ç∂„Éº„Éá„Éº„Çø„ÅåÂâäÈô§„Åï„Çå„Åü„Çä„Åô„Çã„Åì„Å®„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ"
                },
                en: {
                    web_title: "Shupogaki üí¢",
                    title: "Notice",
                    body: "This game is an unofficial fan-made work based on \'Blue Archive\'.",
                    subBody: "The rights of the original copyright holder, Nexon Games, are respected with the highest priority, and this content will be made private or deleted upon request.",
                    start: "- Click to Start the Game -",
                    disclaimer: "Disclaimer: Issues that impede gameplay may occur, and the service may be suspended or user data deleted without notice."
                }
            };

            // Î∏åÎùºÏö∞Ï†Ä Ïñ∏Ïñ¥ Í∞êÏßÄ Î∞è ÌÖçÏä§Ìä∏ Ï†ÅÏö©
            const userLang = navigator.language.split('-')[0]; // 'ko-KR' -> 'ko'
            const lang = translations[userLang] ? userLang : 'en'; // ÏßÄÏõê Ïñ∏Ïñ¥ ÏóÜÏúºÎ©¥ ÏòÅÏñ¥Î°ú
            
            document.title = translations[lang].web_title;
            document.getElementById('text-title').textContent = translations[lang].title;
            document.getElementById('text-body').textContent = translations[lang].body;
            document.getElementById('text-sub-body').textContent = translations[lang].subBody;
            document.getElementById('text-start').textContent = translations[lang].start;
            document.getElementById('text-disclaimer').textContent = translations[lang].disclaimer;
            
            // Bevy Ïï± Ïã§Ìñâ Ìï®Ïàò 
            async function runBevyApp() {
                await init();
                const canvas = document.querySelector('canvas');
                if (canvas) {
                    container.appendChild(canvas);

                    function resizeCanvas() {
                        const containerRect = container.getBoundingClientRect();
                        const aspectRatio = 16 / 9;
                        let newWidth, newHeight;
                        if (containerRect.width / containerRect.height > aspectRatio) {
                            newHeight = containerRect.height;
                            newWidth = newHeight * aspectRatio;
                        } else {
                            newWidth = containerRect.width;
                            newHeight = newWidth / aspectRatio;
                        }
                        canvas.style.width = newWidth + 'px';
                        canvas.style.height = newHeight + 'px';
                    }
                    window.addEventListener('resize', resizeCanvas);
                    resizeCanvas();
                }
            }

            // Ïò§ÎîîÏò§ ÌôúÏÑ±Ìôî Î∞è Í≤åÏûÑ ÏãúÏûë Ìï®Ïàò 
            const unlockAudioAndStartGame = async () => {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                }
                const source = audioContext.createBufferSource();
                source.buffer = audioContext.createBuffer(1, 1, 22050);
                source.connect(audioContext.destination);
                source.start(0);
                startOverlay.style.display = 'none';
                await runBevyApp();
            };

            // ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà 
            startOverlay.addEventListener('click', unlockAudioAndStartGame, { once: true });
        </script>

        <script type="module">
            window.tutorialImages = [];
            window.tutorialIndex = 0;

            window.start_tutorial = function (lang) {
                switch (lang) {
                    case "ko":
                        window.tutorialImages = [
                            "assets/tutorial/Tutorial_ko_0.png", 
                            "assets/tutorial/Tutorial_ko_1.png"
                        ];
                        break;
                    case "ja": 
                        window.tutorialImages = [
                            "assets/tutorial/Tutorial_ja_0.png", 
                            "assets/tutorial/Tutorial_ja_1.png"
                        ];
                        break;
                    default:
                        window.tutorialImages = [
                            "assets/tutorial/Tutorial_en_0.png", 
                            "assets/tutorial/Tutorial_en_1.png"
                        ];
                }

                window.tutorialIndex = 0;
                document.getElementById("tutorial-image").src = window.tutorialImages[0];
                document.getElementById("tutorial-overlay").style.display = "flex";
            };

            document.getElementById("tutorial-overlay").addEventListener("click", () => {
                window.tutorialIndex++;
                if (window.tutorialIndex < window.tutorialImages.length) {
                    document.getElementById("tutorial-image").src = window.tutorialImages[window.tutorialIndex];
                } else {
                    document.getElementById("tutorial-overlay").style.display = "none";
                }
            });
        </script>
    </body>
</html>
