<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>Shupogaki 💢</title>
        <style>
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #6F8FAF; /* 캔버스 바깥 배경색 */
            overflow: hidden;
        }
        .canvas-container {
            /* 기존 스타일 유지 */
            width: 150vmin;
            height: 150vmin;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative; /* 오버레이 위치 기준을 위해 추가 */
        }
        canvas {
            /* 기존 스타일 유지 */
            max-width: 100%;
            max-height: 100%;
            display: block;
        }
        /* --- 추가된 스타일 --- */
        #start-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 3em;
            font-family: sans-serif;
            cursor: pointer;
            z-index: 10; /* 캔버스 위에 표시되도록 z-index 추가 */
            text-align: center;
        }
        </style>
    </head>
    <body>
        <div class="canvas-container"></div>
        
        <div id="start-overlay">
            <p>Click to Start</p>
        </div>

        <script type="module">
            // Bevy 앱 초기화 로직은 그대로 사용
            import init from './shupogaki.js';

            const startOverlay = document.getElementById('start-overlay');
            const container = document.querySelector('.canvas-container');

            // Bevy 앱을 실행하는 기존 함수
            async function runBevyApp() {
                await init();
                const canvas = document.querySelector('canvas');
                if (canvas) {
                    container.appendChild(canvas);

                    function resizeCanvas() {
                        const containerRect = container.getBoundingClientRect();
                        const aspectRatio = 16 / 9;
                        let newWidth, newHeight;
                        if (containerRect.width / containerRect.height > aspectRatio) {
                            newHeight = containerRect.height;
                            newWidth = newHeight * aspectRatio;
                        } else {
                            newWidth = containerRect.width;
                            newHeight = newWidth / aspectRatio;
                        }
                        canvas.style.width = newWidth + 'px';
                        canvas.style.height = newHeight + 'px';
                    }
                    window.addEventListener('resize', resizeCanvas);
                    resizeCanvas();
                }
            }

            // 오버레이 클릭 시 오디오를 활성화하고 게임을 시작하는 새 함수
            const unlockAudioAndStartGame = async () => {
                // 1. 오디오 잠금 해제
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                if (audioContext.state === 'suspended') {
                    await audioContext.resume();
                }
                const source = audioContext.createBufferSource();
                source.buffer = audioContext.createBuffer(1, 1, 22050);
                source.connect(audioContext.destination);
                source.start(0);
                
                // 2. 오버레이 숨기기
                startOverlay.style.display = 'none';

                // 3. 기존 Bevy 앱 실행 함수 호출
                await runBevyApp();
            };

            // 오버레이에 클릭 이벤트 리스너 추가 (한 번만 실행)
            startOverlay.addEventListener('click', unlockAudioAndStartGame, { once: true });
        </script>
    </body>
</html>